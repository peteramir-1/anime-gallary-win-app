<div appWidgetContainer>
  <article class="flex flex-col gap-7" appScrollable>
    <!--
  + RETUN BACK Button "<--"
  -->
    <button
      class="btn btn-secondary"
      type="button"
      routerLink="/library"
      role="navigation">
      <ng-icon name="heroArrowLeft"></ng-icon>
    </button>

    <!--
  + ADD Anime Form ->
  + Currently emplemented Fields:
  +   1. Name (required)
  +   2. Number of Episodes (required)
  +   3. Thumbnail or Picture for anime (optional)
  +   4. Story (optional)
  +   5. Status of the anime[Complete, InComplete] (required | has a Default Value)
  +   6. Type of the anime[serie, ova, movie] (required | has a Default Value)
  +   7. episodes[Array(string)] (required | at least one episode)
  + TODO:
  +   [] Implement visible form validation
  -->
    <form
      [formGroup]="_animeForm"
      class="flex h-fit max-w-full flex-initial flex-col gap-16">
      <section class="flex flex-col gap-2">
        <h1
          class="mb-4 text-4xl font-extrabold leading-none tracking-normal text-gray-900 dark:text-white">
          {{ !anime ? 'Create A New Anime' : 'Edit an Anime' }}
        </h1>
        <section class="flex h-[35rem] flex-initial flex-row gap-10">
          <section class="flex flex-auto flex-col gap-5">
            <section class="flex flex-initial flex-row gap-5">
              <!-- Name Form Control -->
              <section class="flex flex-auto flex-col">
                <label
                  for="name"
                  class="mb-2 block text-sm font-medium text-gray-900 dark:text-white">
                  Name
                  <span
                    class="ml-2 text-xs font-normal italic text-red-500 dark:text-red-300">
                    required
                  </span>
                </label>
                <input
                  formControlName="name"
                  type="text"
                  id="name"
                  name="name"
                  required
                  class="input" />
              </section>

              <!-- Number of Episodes Form Control -->
              <app-num-input
                inputLabel="Num. of Episodes"
                required
                inputId="numOfEpisodes"
                [inputMin]="1"
                (focusout)="enableScroll()"
                (focusin)="disableScroll()"
                class="flex flex-initial flex-col"
                formControlName="numOfEpisodes"></app-num-input>
            </section>

            <section class="flex flex-initial flex-row gap-5">
              <!-- Released Date Form Control -->
              <section class="flex flex-auto flex-col">
                <label
                  for="released"
                  class="mb-2 block text-sm font-medium text-gray-900 dark:text-white">
                  Released
                  <!-- <span
                  class="ml-2 text-xs font-normal italic text-red-500 dark:text-red-300">
                  required
                </span> -->
                </label>
                <select
                  formControlName="released"
                  type="text"
                  id="released"
                  name="released"
                  class="input w-full rounded-lg border border-gray-300 bg-gray-50 text-sm text-gray-900 focus:border-blue-500 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:placeholder-gray-400 dark:focus:border-blue-500 dark:focus:ring-blue-500">
                  <option [value]="null">N/A</option>
                  @for (year of years; track year) {
                  <option [value]="year">
                    {{ year }}
                  </option>
                  }
                </select>
              </section>

              <!-- Season Form Control -->
              <section class="flex flex-auto flex-col">
                <label
                  for="season"
                  class="mb-2 block text-sm font-medium text-gray-900 dark:text-white">
                  Season
                  <!-- <span
                class="ml-2 text-xs font-normal italic text-red-500 dark:text-red-300">
                required
              </span> -->
                </label>
                <select
                  formControlName="season"
                  type="text"
                  id="season"
                  name="season"
                  class="input w-full rounded-lg border border-gray-300 bg-gray-50 text-sm text-gray-900 focus:border-blue-500 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:placeholder-gray-400 dark:focus:border-blue-500 dark:focus:ring-blue-500">
                  <option [value]="null">N/A</option>
                  <option value="winter">Winter</option>
                  <option value="summer">Summer</option>
                  <option value="spring">Spring</option>
                  <option value="autumn">Autumn</option>
                </select>
              </section>
            </section>

            <!-- Story Form Control -->
            <section class="flex flex-auto flex-col">
              <label
                for="story"
                class="mb-2 text-sm font-medium text-gray-900 dark:text-white">
                Story
              </label>
              <textarea
                id="story"
                resizable
                formControlName="story"
                name="story"
                class="textarea"></textarea>
            </section>

            <section class="flex flex-initial flex-row">
              <!-- Type Form Control -->
              <section class="flex flex-initial basis-1/2 flex-col">
                <label
                  for="type"
                  class="mb-2 text-sm font-medium text-gray-900 dark:text-white">
                  Type
                  <span
                    class="ml-2 text-xs font-normal italic text-red-500 dark:text-red-300">
                    required
                  </span>
                </label>
                <fieldset id="type">
                  <div class="mb-4 flex items-center">
                    <input
                      formControlName="type"
                      id="option-serie"
                      type="radio"
                      name="type"
                      value="serie"
                      class="input" />
                    <label
                      for="option-serie"
                      class="ml-2 block text-sm font-medium text-gray-900 dark:text-gray-300">
                      Serie
                    </label>
                  </div>
                  <div class="mb-4 flex items-center">
                    <input
                      formControlName="type"
                      id="option-movie"
                      type="radio"
                      name="type"
                      value="movie"
                      class="input" />
                    <label
                      for="option-movie"
                      class="ml-2 block text-sm font-medium text-gray-900 dark:text-gray-300">
                      Movie
                    </label>
                  </div>
                  <div class="mb-4 flex items-center">
                    <input
                      formControlName="type"
                      id="option-ova"
                      type="radio"
                      name="type"
                      value="ova"
                      class="input" />
                    <label
                      for="option-ova"
                      class="ml-2 block text-sm font-medium text-gray-900 dark:text-gray-300">
                      OVA
                    </label>
                  </div>
                </fieldset>
              </section>

              <!-- Status Form Control -->
              <section
                class="flex flex-initial flex-col"
                [ngClass]="{
                  hidden: this._animeForm.get('type').value === 'movie'
                }">
                <label
                  for="status"
                  class="mb-2 text-sm font-medium text-gray-900 dark:text-white">
                  Status
                  <span
                    class="ml-2 text-xs font-normal italic text-red-500 dark:text-red-300">
                    required
                  </span>
                </label>
                <fieldset id="status">
                  <div class="mb-4 flex items-center">
                    <input
                      formControlName="status"
                      id="option-complete"
                      type="radio"
                      name="status"
                      value="complete"
                      class="input" />
                    <label
                      for="option-complete"
                      class="ml-2 block text-sm font-medium text-gray-900 dark:text-gray-300">
                      Complete
                    </label>
                  </div>
                  <div class="mb-4 flex items-center">
                    <input
                      formControlName="status"
                      id="option-in-complete"
                      type="radio"
                      name="status"
                      value="incomplete"
                      class="input" />
                    <label
                      for="option-in-complete"
                      class="ml-2 block text-sm font-medium text-gray-900 dark:text-gray-300">
                      Incomplete
                    </label>
                  </div>
                </fieldset>
              </section>
            </section>
          </section>
          <section class="flex w-1/3">
            <image-input formControlName="thumbnail"></image-input>
          </section>
        </section>
      </section>

      <!-- Anime Episodes -->
      <section
        class="flex flex-col gap-2"
        [ngClass]="{
          hidden: this._animeForm.get('type').value === 'movie'
        }">
        <header class="mb-4 flex gap-5">
          <section class="flex flex-col gap-2">
            <h1
              class="flex gap-5 text-3xl font-bold leading-none tracking-normal text-gray-900 dark:text-white">
              Anime Episodes
            </h1>
            <h6
              class="block text-xs text-gray-500 dark:text-gray-300"
              id="file_input_help">
              MP4, MKV, FLV or MWV.
            </h6>
          </section>
          <button
            type="button"
            class="btn btn-secondary p-2.5"
            matTooltip="Select episodes from folder"
            (click)="selectEpisodesFromFolder()">
            <ng-icon name="matFolder"></ng-icon>
          </button>
        </header>
        <section class="grid grid-cols-2 gap-5" formArrayName="episodes">
          @for (num of getEpisodesLength(); track num; let i = $index) {
          <app-form-field
            [for]="'file_input_' + i"
            [label]="'Episode ' + (i + 1)">
            <app-filepath-input
              [formControlName]="i"
              [extensions]="['mp4', 'mkv', 'flv', 'mwv']"
              [id]="'file_input_' + i"></app-filepath-input>
          </app-form-field>
          }
        </section>
      </section>

      <!-- Buttons Section -->
      <section class="flex flex-row items-start gap-5">
        <button
          class="btn btn-outline-danger"
          type="button"
          [routerLink]="
            _animeForm.get('uuid').value === null
              ? ['..']
              : ['/library', 'details', _animeForm.get('uuid').value]
          ">
          Cancel
        </button>
        <button class="btn btn-secondary" type="submit" (click)="submit()">
          {{ !anime ? 'Add' : 'Edit' }}
        </button>
      </section>
    </form>
  </article>
</div>
